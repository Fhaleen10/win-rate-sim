<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KHM4WHNE8K"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-KHM4WHNE8K');
    </script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1794773804909203"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="E-n3xzukzN1tXcncJXvriEuf8157kksZ6awrDtPoV_w" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <title>Win Rate Calculator | Trading Performance & Expected Value Calculator</title>
    <meta name="description" content="Advanced win rate calculator for traders. Includes expected value, profit factor, Kelly Criterion position sizing, break-even win rate, and R:R ratio analysis.">
    <meta name="keywords" content="win rate calculator, expected value trading, profit factor calculator, Kelly criterion, risk reward ratio, break-even win rate, trading performance">

    <!-- Open Graph Tags for Social Media -->
    <meta property="og:title" content="Win Rate Calculator | Trading Performance & Expected Value">
    <meta property="og:description" content="Calculate win rate, expected value, profit factor and Kelly Criterion for your trading strategy. Free advanced trading performance calculator.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://probabilitycalculator.pro/winrate.html">
    <meta property="og:image" content="https://probabilitycalculator.pro/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Schema.org markup for Google -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Win Rate Calculator",
        "description": "Advanced trading performance calculator with win rate, expected value, profit factor, Kelly Criterion, and break-even analysis.",
        "url": "https://probabilitycalculator.pro/winrate.html",
        "applicationCategory": "FinanceApplication",
        "operatingSystem": "Any",
        "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
        "featureList": [
            "Win rate percentage calculation",
            "Expected value per trade",
            "Profit factor analysis",
            "Half Kelly position sizing",
            "Break-even win rate",
            "Risk:Reward ratio",
            "Free to use"
        ]
    }
    </script>

    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ */
        .tab-bar {
            display: flex;
            gap: 0.35rem;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 0.3rem;
            width: fit-content;
            margin: 0 auto 2rem;
        }
        .tab-btn {
            padding: 0.45rem 1.4rem;
            border: none;
            border-radius: 8px;
            background: transparent;
            color: #94a3b8;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        .tab-btn.active {
            background: var(--primary-color);
            color: #111827;
            font-weight: 700;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* ‚îÄ‚îÄ Shared card ‚îÄ‚îÄ */
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.8rem;
            box-shadow: var(--card-shadow);
        }
        .card h3 {
            color: var(--primary-color);
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1.4rem;
        }

        /* ‚îÄ‚îÄ Inputs ‚îÄ‚îÄ */
        .input-group { margin-bottom: 1.2rem; }
        .input-group:last-child { margin-bottom: 0; }
        .input-group label {
            display: block;
            color: #94a3b8;
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 0.4rem;
        }
        .input-group input {
            width: 100%;
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.65rem 1rem;
            color: var(--text-color);
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        .input-group input:focus { outline: none; border-color: var(--primary-color); }
        .input-group input[readonly] { opacity: 0.6; cursor: default; }

        /* ‚îÄ‚îÄ Basic tab big result ‚îÄ‚îÄ */
        .basic-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            max-width: 740px;
            margin: 0 auto;
        }
        @media (max-width: 600px) { .basic-grid { grid-template-columns: 1fr; } }
        .big-wr {
            text-align: center;
            margin-top: 1.4rem;
            padding-top: 1.2rem;
            border-top: 1px solid var(--border-color);
        }
        .big-wr .big-label { font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 0.3rem; }
        .big-wr .big-value { font-size: 3.8rem; font-weight: 700; color: var(--primary-color); line-height: 1; transition: color 0.3s; }
        .big-wr .big-sub   { font-size: 0.8rem; color: #64748b; margin-top: 0.4rem; }
        .basic-donut { position: relative; height: 220px; }

        /* ‚îÄ‚îÄ Advanced: calc grid ‚îÄ‚îÄ */
        .calc-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        @media (max-width: 700px) { .calc-grid { grid-template-columns: 1fr; } }

        /* ‚îÄ‚îÄ R:R badge ‚îÄ‚îÄ */
        .rr-display {
            background: rgba(255,215,0,0.08);
            border: 1px solid rgba(255,215,0,0.25);
            border-radius: 10px;
            padding: 0.9rem 1rem;
            text-align: center;
            margin-top: 1rem;
        }
        .rr-display .rr-label { font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.05em; }
        .rr-display .rr-value { font-size: 1.8rem; font-weight: 700; color: var(--primary-color); }

        /* ‚îÄ‚îÄ Stat cards ‚îÄ‚îÄ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        @media (max-width: 800px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }

        .stat-card {
            background: var(--stat-card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.2rem 1rem;
            text-align: center;
            transition: border-color 0.3s;
        }
        .stat-card .stat-label { font-size: 0.72rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.4rem; }
        .stat-card .stat-value { font-size: 1.7rem; font-weight: 700; color: var(--primary-color); transition: color 0.3s; }
        .stat-card .stat-sub   { font-size: 0.72rem; color: #64748b; margin-top: 0.25rem; }
        .stat-card.good { border-color: rgba(16,185,129,0.35); }
        .stat-card.good .stat-value { color: #10b981; }
        .stat-card.bad  { border-color: rgba(239,68,68,0.35); }
        .stat-card.bad  .stat-value { color: #ef4444; }
        .stat-card.warn { border-color: rgba(245,158,11,0.35); }
        .stat-card.warn .stat-value { color: #f59e0b; }

        /* ‚îÄ‚îÄ Break-even banner ‚îÄ‚îÄ */
        .breakeven-banner {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }
        .be-label { font-size: 0.85rem; color: #94a3b8; }
        .be-label strong { color: var(--text-color); }
        .be-value { font-size: 1.5rem; font-weight: 700; color: var(--primary-color); }
        .be-verdict { font-size: 0.82rem; padding: 0.3rem 0.75rem; border-radius: 20px; font-weight: 600; }
        .be-verdict.positive { background: rgba(16,185,129,0.15); color: #10b981; }
        .be-verdict.negative { background: rgba(239,68,68,0.15);  color: #ef4444; }
        .be-verdict.neutral  { background: rgba(245,158,11,0.15);  color: #f59e0b; }

        /* ‚îÄ‚îÄ Charts ‚îÄ‚îÄ */
        .chart-wrap { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem; }
        @media (max-width: 650px) { .chart-wrap { grid-template-columns: 1fr; } }
        .chart-inner { position: relative; height: 260px; }

        /* ‚îÄ‚îÄ Interpretation ‚îÄ‚îÄ */
        .interp-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-top: 1rem; }
        @media (max-width: 700px) { .interp-grid { grid-template-columns: 1fr; } }
        .interp-item { background: var(--stat-card-bg); border: 1px solid var(--border-color); border-radius: 10px; padding: 1rem; }
        .interp-item h4 { color: var(--primary-color); font-size: 0.85rem; margin-bottom: 0.4rem; }
        .interp-item p  { font-size: 0.82rem; color: #94a3b8; line-height: 1.5; }
    </style>
</head>
<body>
    <header class="main-header">
        <nav>
            <div class="nav-dropdown" id="investingDropdown">
                <a class="nav-dropdown-trigger" onclick="toggleDropdown(event)">Investing Tools &#9660;</a>
                <div class="nav-dropdown-menu">
                    <a href="investing.html">Investment Calculator</a>
                    <a href="dca.html">DCA Calculator</a>
                    <a href="dividend.html">Dividend / DRIP</a>
                    <a href="staking.html">Crypto Staking</a>
                    <a href="portfolio.html">Portfolio Allocator</a>
                </div>
            </div>
            <a href="index.html">Probability Calculator</a>
            <a href="winrate.html" class="active">Win Rate Calculator</a>
        </nav>
    </header>
    <script>
        function toggleDropdown(e) {
            e.preventDefault();
            const dd = document.getElementById('investingDropdown');
            dd.classList.toggle('open');
        }
        document.addEventListener('click', function(e) {
            const dd = document.getElementById('investingDropdown');
            if (dd && !dd.contains(e.target)) dd.classList.remove('open');
        });
    </script>

    <div class="container">
        <h1>Win Rate Calculator</h1>

        <!-- Tab bar -->
        <div class="tab-bar">
            <button class="tab-btn active" id="btn-basic"    onclick="switchTab('basic')">Basic</button>
            <button class="tab-btn"        id="btn-advanced" onclick="switchTab('advanced')">Advanced</button>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BASIC TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div id="tab-basic" class="tab-content active">
            <div class="basic-grid">
                <div class="card">
                    <h3>Quick Win Rate</h3>
                    <div class="input-group">
                        <label>Number of Wins</label>
                        <input type="number" id="bWins" min="0" placeholder="e.g. 55" oninput="calcBasic()">
                    </div>
                    <div class="input-group">
                        <label>Number of Losses</label>
                        <input type="number" id="bLosses" min="0" placeholder="e.g. 45" oninput="calcBasic()">
                    </div>
                    <div class="input-group">
                        <label>Total Trades</label>
                        <input type="number" id="bTotal" readonly placeholder="0">
                    </div>
                    <div class="big-wr">
                        <div class="big-label">Win Rate</div>
                        <div class="big-value" id="bWinRate">0%</div>
                        <div class="big-sub" id="bWinSub">Enter wins and losses above</div>
                    </div>
                </div>
                <div class="card">
                    <h3>Win / Loss Split</h3>
                    <div class="basic-donut">
                        <canvas id="bDonut"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADVANCED TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div id="tab-advanced" class="tab-content">

            <!-- Presets -->
            <div style="display:flex;gap:0.75rem;flex-wrap:wrap;margin-bottom:1.5rem;justify-content:center;">
                <button class="preset-btn" onclick="applyPreset('scalper',event)">‚ö° Scalper</button>
                <button class="preset-btn" onclick="applyPreset('swing',event)">üìà Swing Trader</button>
                <button class="preset-btn" onclick="applyPreset('prop',event)">üèÜ Prop Firm</button>
            </div>

            <!-- Inputs -->
            <div class="calc-grid">
                <div class="card">
                    <h3>Trade Statistics</h3>
                    <div class="input-group">
                        <label>Number of Wins</label>
                        <input type="number" id="wins" min="0" placeholder="e.g. 55" oninput="calculate()">
                    </div>
                    <div class="input-group">
                        <label>Number of Losses</label>
                        <input type="number" id="losses" min="0" placeholder="e.g. 45" oninput="calculate()">
                    </div>
                    <div class="input-group">
                        <label>Total Trades</label>
                        <input type="number" id="total" readonly placeholder="0">
                    </div>
                </div>
                <div class="card">
                    <h3>Average Trade Size</h3>
                    <div class="input-group">
                        <label>Average Win ($)</label>
                        <input type="number" id="avgWin" min="0" step="0.01" placeholder="e.g. 160" oninput="calculate()">
                    </div>
                    <div class="input-group">
                        <label>Average Loss ($)</label>
                        <input type="number" id="avgLoss" min="0" step="0.01" placeholder="e.g. 100" oninput="calculate()">
                    </div>
                    <div class="rr-display">
                        <div class="rr-label">Risk : Reward Ratio</div>
                        <div class="rr-value" id="rrDisplay">‚Äî</div>
                    </div>
                </div>
            </div>

            <!-- Stat cards -->
            <div class="stats-grid">
                <div class="stat-card" id="card-wr">
                    <div class="stat-label">Win Rate</div>
                    <div class="stat-value" id="statWR">‚Äî</div>
                    <div class="stat-sub">of all trades</div>
                </div>
                <div class="stat-card" id="card-ev">
                    <div class="stat-label">Exp. Value / Trade</div>
                    <div class="stat-value" id="statEV">‚Äî</div>
                    <div class="stat-sub">avg $ per trade</div>
                </div>
                <div class="stat-card" id="card-pf">
                    <div class="stat-label">Profit Factor</div>
                    <div class="stat-value" id="statPF">‚Äî</div>
                    <div class="stat-sub">gross wins / gross losses</div>
                </div>
                <div class="stat-card" id="card-kelly">
                    <div class="stat-label">Half Kelly %</div>
                    <div class="stat-value" id="statKelly">‚Äî</div>
                    <div class="stat-sub" id="statKellySub">recommended risk/trade</div>
                </div>
            </div>

            <!-- Break-even banner -->
            <div class="breakeven-banner">
                <div class="be-label">
                    <strong>Break-Even Win Rate</strong><br>
                    Minimum WR needed to be profitable at your R:R
                </div>
                <div class="be-value" id="beValue">‚Äî</div>
                <div class="be-verdict" id="beVerdict"></div>
            </div>

            <!-- Charts -->
            <div class="chart-wrap">
                <div class="card">
                    <h3>Win / Loss Split</h3>
                    <div class="chart-inner"><canvas id="donutChart"></canvas></div>
                </div>
                <div class="card">
                    <h3>Strategy Health</h3>
                    <div class="chart-inner"><canvas id="barChart"></canvas></div>
                </div>
            </div>

            <!-- Interpretation -->
            <div class="card">
                <h3>How to Interpret Your Results</h3>
                <div class="interp-grid">
                    <div class="interp-item">
                        <h4>Expected Value (EV)</h4>
                        <p>EV = (Win Rate √ó Avg Win) ‚àí (Loss Rate √ó Avg Loss). Positive EV means the strategy is profitable long-term even with a sub-50% win rate.</p>
                    </div>
                    <div class="interp-item">
                        <h4>Profit Factor</h4>
                        <p>Total gross wins divided by total gross losses. Above 1.5 is solid. Above 2.0 is excellent. Below 1.0 means you're losing money overall.</p>
                    </div>
                    <div class="interp-item">
                        <h4>Half Kelly</h4>
                        <p>Full Kelly gives the mathematically maximum growth rate but causes extreme drawdowns. Half Kelly (√∑2) is the practical standard ‚Äî most professional traders cap risk at 1‚Äì2% regardless.</p>
                    </div>
                </div>
            </div>
        </div><!-- end advanced tab -->
    </div>

    <footer class="main-footer">
        <nav><a href="privacy.html">Privacy Policy</a></nav>
    </footer>

    <script>
        /* ‚îÄ‚îÄ Tab switching ‚îÄ‚îÄ */
        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.add('active');
            document.getElementById('btn-' + tab).classList.add('active');
        }

        /* ‚îÄ‚îÄ Basic calculator ‚îÄ‚îÄ */
        let bDonutChart = null;

        function calcBasic() {
            const wins   = parseFloat(document.getElementById('bWins').value)   || 0;
            const losses = parseFloat(document.getElementById('bLosses').value) || 0;
            const total  = wins + losses;
            document.getElementById('bTotal').value = total || '';

            const wr = total > 0 ? (wins / total) * 100 : 0;
            const wrEl = document.getElementById('bWinRate');
            const subEl = document.getElementById('bWinSub');

            wrEl.textContent = total > 0 ? wr.toFixed(1) + '%' : '0%';
            wrEl.style.color = wr >= 50 ? '#10b981' : wr >= 40 ? '#f59e0b' : wr > 0 ? '#ef4444' : 'var(--primary-color)';

            if (total > 0) {
                subEl.textContent = `${wins} wins ¬∑ ${losses} losses`;
            } else {
                subEl.textContent = 'Enter wins and losses above';
            }

            // Donut
            const ctx = document.getElementById('bDonut').getContext('2d');
            if (bDonutChart) bDonutChart.destroy();
            if (total > 0) {
                bDonutChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Wins', 'Losses'],
                        datasets: [{
                            data: [wins, losses],
                            backgroundColor: ['rgba(255,215,0,0.85)', 'rgba(239,68,68,0.7)'],
                            borderColor:     ['rgba(255,215,0,1)',    'rgba(239,68,68,1)'],
                            borderWidth: 2,
                            hoverOffset: 6
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false, cutout: '65%',
                        plugins: {
                            legend: { labels: { color: '#e2e8f0', font: { family: 'Inter' }, padding: 16 } },
                            tooltip: { callbacks: { label: c => ` ${c.label}: ${c.raw} (${(c.raw/total*100).toFixed(1)}%)` } }
                        }
                    }
                });
            }
        }

        /* ‚îÄ‚îÄ Advanced calculator ‚îÄ‚îÄ */
        let donutChart = null, barChart = null;

        const presets = {
            scalper: { wins: 130, losses: 70,  avgWin: 50,  avgLoss: 80  },
            swing:   { wins: 45,  losses: 55,  avgWin: 220, avgLoss: 100 },
            prop:    { wins: 55,  losses: 45,  avgWin: 160, avgLoss: 100 }
        };

        function applyPreset(key, e) {
            const p = presets[key];
            document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active-preset'));
            e.target.classList.add('active-preset');
            document.getElementById('wins').value    = p.wins;
            document.getElementById('losses').value  = p.losses;
            document.getElementById('avgWin').value  = p.avgWin;
            document.getElementById('avgLoss').value = p.avgLoss;
            calculate();
        }

        function fmt(n, d = 2) { return isNaN(n) ? '‚Äî' : n.toFixed(d); }

        function setCard(cardId, statId, text, type) {
            document.getElementById(statId).textContent = text;
            document.getElementById(cardId).className   = 'stat-card ' + (type || '');
        }

        function calculate() {
            const wins    = parseFloat(document.getElementById('wins').value)    || 0;
            const losses  = parseFloat(document.getElementById('losses').value)  || 0;
            const avgWin  = parseFloat(document.getElementById('avgWin').value)  || 0;
            const avgLoss = parseFloat(document.getElementById('avgLoss').value) || 0;
            const total   = wins + losses;

            document.getElementById('total').value = total || '';
            if (total === 0) { resetAll(); return; }

            const wr = wins / total;
            const lr = 1 - wr;
            const rr = avgLoss > 0 && avgWin > 0 ? avgWin / avgLoss : null;

            // R:R
            document.getElementById('rrDisplay').textContent = rr !== null ? fmt(rr, 2) + ' : 1' : '‚Äî';

            // Win Rate
            const wrPct  = wr * 100;
            const wrType = wrPct >= 50 ? 'good' : wrPct >= 40 ? 'warn' : 'bad';
            setCard('card-wr', 'statWR', fmt(wrPct, 1) + '%', wrType);

            // EV
            if (avgWin > 0 && avgLoss > 0) {
                const ev     = wr * avgWin - lr * avgLoss;
                const evType = ev > 0 ? 'good' : ev < 0 ? 'bad' : 'warn';
                setCard('card-ev', 'statEV', (ev >= 0 ? '+' : '') + '$' + fmt(ev, 2), evType);
            } else {
                setCard('card-ev', 'statEV', '‚Äî', '');
            }

            // Profit Factor
            if (avgWin > 0 && avgLoss > 0 && losses > 0) {
                const pf     = (wins * avgWin) / (losses * avgLoss);
                const pfType = pf >= 1.5 ? 'good' : pf >= 1.0 ? 'warn' : 'bad';
                setCard('card-pf', 'statPF', fmt(pf, 2), pfType);
            } else {
                setCard('card-pf', 'statPF', '‚Äî', '');
            }

            // Half Kelly (practical recommendation)
            if (rr !== null) {
                const fullKelly = wr - lr / rr;
                const halfKelly = fullKelly / 2;
                const hkPct     = Math.max(0, halfKelly) * 100;
                const fkPct     = Math.max(0, fullKelly) * 100;
                const kType     = hkPct > 0 ? 'good' : 'bad';
                setCard('card-kelly', 'statKelly', hkPct > 0 ? fmt(hkPct, 1) + '%' : '0%', kType);
                document.getElementById('statKellySub').textContent =
                    hkPct > 0 ? `Full Kelly: ${fmt(fkPct, 1)}% ¬∑ use ‚â§2% in practice` : 'strategy not Kelly-positive';
            } else {
                setCard('card-kelly', 'statKelly', '‚Äî', '');
                document.getElementById('statKellySub').textContent = 'recommended risk/trade';
            }

            // Break-even
            const beEl      = document.getElementById('beValue');
            const beVerdict = document.getElementById('beVerdict');
            if (rr !== null) {
                const beWR   = 1 / (1 + rr) * 100;
                const margin = wrPct - beWR;
                beEl.textContent = fmt(beWR, 1) + '%';
                if (margin > 0) {
                    beVerdict.textContent = '+' + fmt(margin, 1) + '% above break-even ‚úì';
                    beVerdict.className = 'be-verdict positive';
                } else if (margin < 0) {
                    beVerdict.textContent = fmt(margin, 1) + '% below break-even ‚úó';
                    beVerdict.className = 'be-verdict negative';
                } else {
                    beVerdict.textContent = 'Exactly at break-even';
                    beVerdict.className = 'be-verdict neutral';
                }
            } else {
                beEl.textContent = '‚Äî';
                beVerdict.textContent = '';
                beVerdict.className = 'be-verdict';
            }

            updateDonut(wins, losses);
            updateBar(wr, rr, avgWin, avgLoss);
        }

        function updateDonut(wins, losses) {
            const ctx = document.getElementById('donutChart').getContext('2d');
            if (donutChart) donutChart.destroy();
            donutChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Wins', 'Losses'],
                    datasets: [{
                        data: [wins, losses],
                        backgroundColor: ['rgba(255,215,0,0.85)', 'rgba(239,68,68,0.7)'],
                        borderColor:     ['rgba(255,215,0,1)',    'rgba(239,68,68,1)'],
                        borderWidth: 2, hoverOffset: 6
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, cutout: '65%',
                    plugins: {
                        legend: { labels: { color: '#e2e8f0', font: { family: 'Inter' }, padding: 16 } },
                        tooltip: { callbacks: { label: c => ` ${c.label}: ${c.raw} (${(c.parsed/(wins+losses)*100).toFixed(1)}%)` } }
                    }
                }
            });
        }

        function updateBar(wr, rr, avgWin, avgLoss) {
            const ctx = document.getElementById('barChart').getContext('2d');
            if (barChart) barChart.destroy();

            const lr        = 1 - wr;
            const hasValues = avgWin > 0 && avgLoss > 0;
            const beWR      = rr !== null ? (1 / (1 + rr)) * 100                          : null;
            const halfKelly = rr !== null ? Math.max(0, (wr - lr / rr) / 2) * 100         : null;
            const pf        = hasValues && lr > 0 ? (wr * avgWin) / (lr * avgLoss)        : null;

            const labels = ['Win Rate %', 'Break-Even %', 'Half Kelly %', 'Profit Factor'];
            const values = [wr * 100, beWR ?? 0, halfKelly ?? 0, pf ?? 0];
            const colors = [
                wr * 100 >= 50             ? 'rgba(16,185,129,0.75)' : 'rgba(239,68,68,0.7)',
                'rgba(148,163,184,0.5)',
                halfKelly > 0              ? 'rgba(255,215,0,0.75)'  : 'rgba(239,68,68,0.7)',
                pf !== null && pf >= 1     ? 'rgba(16,185,129,0.75)' : 'rgba(239,68,68,0.7)'
            ];

            barChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        data: values,
                        backgroundColor: colors,
                        borderColor: colors.map(c => c.replace('0.75','1').replace('0.7','1').replace('0.5','0.8')),
                        borderWidth: 1, borderRadius: 6
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: c => c.label === 'Profit Factor' ? ` PF: ${c.raw.toFixed(2)}` : ` ${c.raw.toFixed(2)}%` } }
                    },
                    scales: {
                        x: { ticks: { color: '#94a3b8', font: { family: 'Inter', size: 11 } }, grid: { display: false } },
                        y: { ticks: { color: '#94a3b8', font: { family: 'Inter' } }, grid: { color: 'rgba(255,255,255,0.06)' } }
                    }
                }
            });
        }

        function resetAll() {
            ['statWR','statEV','statPF','statKelly'].forEach(id => document.getElementById(id).textContent = '‚Äî');
            ['card-wr','card-ev','card-pf','card-kelly'].forEach(id => document.getElementById(id).className = 'stat-card');
            document.getElementById('rrDisplay').textContent      = '‚Äî';
            document.getElementById('beValue').textContent        = '‚Äî';
            document.getElementById('beVerdict').textContent      = '';
            document.getElementById('beVerdict').className        = 'be-verdict';
            document.getElementById('statKellySub').textContent   = 'recommended risk/trade';
            if (donutChart) { donutChart.destroy(); donutChart = null; }
            if (barChart)   { barChart.destroy();   barChart   = null; }
        }
    </script>
</body>
</html>
